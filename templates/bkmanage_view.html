<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    {% include "load_bootstrap.html" %}
</head>
<body>
<h3>用户信息管理</h3>
<form action="/bkmanage/userinfo" method="post">
    {% csrf_token %}
    <input type="text" name="username" placeholder="用户名"/>
    <input type="text" name="password" placeholder="密码"/>
    <input type="text" name="priv" placeholder="权限"/>
    <input type="submit" value="添加"/>
</form>
<p style="color: red">{{ error_msg }}</p>
<div style="width: 50%;border: solid black 1px;font-size: 20px">
    <table class="table  table-hover">
        <tr>
            <td>序号</td>
            <td>用户名</td>
            <td>密码</td>
            <td>权限</td>
        </tr>
        {% for userinfo in all_userinfo %}
            <tr>
                <td>{{ userinfo.userid }}</td>
                <td>{{ userinfo.username }}</td>
                <td>{{ userinfo.password }}</td>
                <td>{{ userinfo.user_priv }}</td>
                <td>
                    <input type="button" class="btn btn-primary" value="编辑"/>
                </td>
                <td>
                    <input type="button" class="btn btn-danger" BkMUserDel="BkMUserDel" value="删除"/>
                </td>
            </tr>
        {% endfor %}
    </table>
</div>
</body>

<script>
    $(function () {
        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                xhr.setRequestHeader('X-CSRFtoken', $.cookie('csrftoken'));
            }
        })
    })
    $('[BkMUserDel="BkMUserDel"]').click(function () {
        $.ajax({
            url:'/bkmanage/BmUserDel',
            method:'POST',
            data:{'userid':$(this).parent().siblings().eq(0).text()},
            success:function (data) {
                location.reload()
            }
        })
    })
</script>
</html>