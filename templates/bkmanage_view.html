<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    {% include "load_bootstrap.html" %}
</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand">后台管理</a>
        </div>
        <div>
            <form class="navbar-form navbar-left" role="search" action="/bkmanage/logout" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-default">注销</button>
            </form>
        </div>
    </div>
</nav>

<ul id="myTab" class="nav nav-tabs">
    <li class="active">
        <a href="#userinfo" data-toggle="tab" style="font-size: 20px">用户信息管理</a>
    </li>
    <li>
        <a href="#dbinfo" data-toggle="tab" style="font-size: 20px">数据库信息管理</a>
    </li>
</ul>

<div id="myTabContent" class="tab-content">
    <div class="tab-pane fade in active" id="userinfo">
        <br>
        <br>
        <form action="/bkmanage/userinfo" method="post">
            {% csrf_token %}
            <input type="text" name="username" placeholder="用户名"/>
            <input type="text" name="password" placeholder="密码"/>
            <input type="text" name="priv" placeholder="权限"/>
            <input type="submit" value="添加"/>
        </form>
        <p style="color: red">{{ error_msg }}</p>
        <div style="width: 50%;border: solid black 1px;font-size: 20px">
            <table class="table  table-hover">
                <tr>
                    <td>序号</td>
                    <td>用户名</td>
                    <td>密码</td>
                    <td>权限</td>
                </tr>
                {% for userinfo in all_userinfo %}
                    <tr>
                        <td>{{ userinfo.userid }}</td>
                        <td>{{ userinfo.username }}</td>
                        <td>{{ userinfo.password }}</td>
                        <td>{{ userinfo.user_priv }}</td>
                        <td>
                            <input type="button" class="btn btn-primary" BkMUserModify="BkMUserModify" value="编辑"/>
                        </td>
                        <td>
                            <input type="button" class="btn btn-danger" BkMUserDel="BkMUserDel" value="删除"/>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    <div class="tab-pane fade" id="dbinfo">

    </div>
</div>
</body>

<script>
    $(function () {
        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                xhr.setRequestHeader('X-CSRFtoken', $.cookie('csrftoken'));
            }
        })
    })
    $('[BkMUserDel="BkMUserDel"]').click(function () {
        $.ajax({
            url: '/bkmanage/BmUserDel',
            method: 'POST',
            data: {'userid': $(this).parent().siblings().eq(0).text()},
            success: function (data) {
                location.reload()
            }
        })
    })
</script>
</html>